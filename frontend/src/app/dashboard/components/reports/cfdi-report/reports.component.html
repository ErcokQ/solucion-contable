<section class="space-y-6">
  <!-- Filtros ------------------------------------------------>
  <div class="flex flex-wrap gap-3 items-end">
    <!-- Rango -->
    <label class="text-sm">
      Desde
      <input
        type="date"
        class="border px-2 py-1 rounded text-sm"
        [value]="fechaDesde()"
        (input)="fechaDesde.set($any($event.target).value)"
      />
    </label>

    <label class="text-sm">
      Hasta
      <input
        type="date"
        class="border px-2 py-1 rounded text-sm"
        [value]="fechaHasta()"
        (input)="fechaHasta.set($any($event.target).value)"
      />
    </label>

    <!-- Tipo ► sólo usable si hay RFC -->
    <select
      class="border px-2 py-1 rounded text-sm"
      [disabled]="!rfc()"
      [value]="tipo()"
      (change)="tipo.set($any($event.target).value)"
    >
      <option value="emitidos">Emitidos</option>
      <option value="recibidos">Recibidos</option>
      <option value="cancelados">Cancelados</option>
    </select>

    <!-- RFC único -->
    <input
      placeholder="RFC de la empresa"
      class="border px-2 py-1 rounded text-sm uppercase"
      [value]="rfc()"
      (input)="rfc.set($any($event.target).value.trim().toUpperCase())"
    />

    <!-- Acciones -->
    <button
      class="bg-teal-600 text-white px-4 py-1 rounded"
      (click)="fetch()"
      [disabled]="!rfc()"
    >
      Buscar
    </button>

    <button
      class="bg-amber-500 text-white px-4 py-1 rounded flex items-center gap-1"
      (click)="exportXlsx()"
      [disabled]="rows().length === 0"
    >
      <svg
        class="w-4 h-4"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M4 16v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2M7 10l5 5m0 0l5-5m-5 5V4"
        />
      </svg>
      XLSX
    </button>
  </div>

  <!-- Tabla -------------------------------------------------->
  <div class="overflow-x-auto rounded-lg shadow border bg-white">
    <table class="min-w-full text-sm">
      <thead class="bg-gray-100 text-xs text-gray-600 text-left">
        <tr>
          <th class="px-3 py-2">UUID</th>
          <th class="px-3 py-2">Fecha</th>
          <th class="px-3 py-2">Emisor</th>
          <th class="px-3 py-2">Receptor</th>
          <th class="px-3 py-2 text-right">Total</th>
          <th class="px-3 py-2">Estatus</th>
        </tr>
      </thead>
      <tbody>
        @if (loading()) {
          <tr>
            <td colspan="6" class="text-center py-4 text-gray-500">
              Cargando…
            </td>
          </tr>
        } @else if (rows().length === 0) {
          <tr>
            <td colspan="6" class="text-center py-4 text-gray-400">
              Sin resultados
            </td>
          </tr>
        } @else {
          @for (r of rows(); track r.UUID) {
            <tr class="border-t hover:bg-gray-50">
              <td class="px-3 py-1 font-mono text-xs">{{ r.UUID }}</td>
              <td class="px-3 py-1">{{ r.Fecha | date: "dd/MM/yyyy" }}</td>
              <td class="px-3 py-1">{{ r.RFC_Emisor }}</td>
              <td class="px-3 py-1">{{ r.RFC_Receptor }}</td>
              <td class="px-3 py-1 text-right">{{ r.Total }}</td>
              <td class="px-3 py-1">{{ r.Estatus }}</td>
            </tr>
          }
        }
      </tbody>
    </table>
  </div>

  <!-- Error -->
  @if (error()) {
    <p class="text-red-600 text-sm">{{ error() }}</p>
  }
</section>
