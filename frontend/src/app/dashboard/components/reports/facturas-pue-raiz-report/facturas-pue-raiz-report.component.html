<section class="space-y-4">
  <!-- Filtros -->
  <div class="flex flex-wrap gap-4 items-end">
    <label class="flex flex-col text-xs text-gray-500">
      <span>RFC propio</span>
      <input
        type="text"
        class="border px-3 py-1.5 rounded text-sm w-52"
        [value]="rfc()"
        (input)="rfc.set($any($event.target).value)"
      />
    </label>

    <label class="flex flex-col text-xs text-gray-500">
      <span>Tipo</span>
      <select
        class="border px-2 py-1 rounded text-sm"
        [value]="tipo()"
        (change)="tipo.set($any($event.target).value)"
      >
        <option value="emitidos">Emitidos</option>
        <option value="recibidos">Recibidos</option>
      </select>
    </label>

    <label class="flex flex-col text-xs text-gray-500">
      <span>Desde</span>
      <input
        type="date"
        class="border px-2 py-1 rounded text-sm"
        [value]="fechaDesde()"
        (input)="fechaDesde.set($any($event.target).value)"
      />
    </label>

    <label class="flex flex-col text-xs text-gray-500">
      <span>Hasta</span>
      <input
        type="date"
        class="border px-2 py-1 rounded text-sm"
        [value]="fechaHasta()"
        (input)="fechaHasta.set($any($event.target).value)"
      />
    </label>

    <div class="flex gap-2">
      <button
        class="px-4 py-1.5 bg-teal-600 text-white rounded text-sm disabled:opacity-60"
        [disabled]="loading()"
        (click)="buscar()"
      >
        Buscar
      </button>

      <button
        class="px-4 py-1.5 bg-gray-700 text-white rounded text-sm disabled:opacity-60"
        [disabled]="loading() || !rows().length"
        (click)="exportarXlsx()"
      >
        Exportar XLSX
      </button>
    </div>
  </div>

  <!-- Error -->
  <p *ngIf="error()" class="text-sm text-red-600">
    {{ error() }}
  </p>

  <!-- Tabla -->
  <div class="overflow-auto max-h-[480px]" *ngIf="rows().length">
    <table class="min-w-full text-xs border">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-2 py-1 border">UUID Factura</th>
          <th class="px-2 py-1 border">Fecha</th>
          <th class="px-2 py-1 border">RFC Emisor</th>
          <th class="px-2 py-1 border">RFC Receptor</th>
          <th class="px-2 py-1 border">RFC Contraparte</th>
          <th class="px-2 py-1 border">MÃ©todo</th>
          <th class="px-2 py-1 border">Forma</th>
          <th class="px-2 py-1 border">Total factura</th>
          <th class="px-2 py-1 border"># Pagos</th>
          <th class="px-2 py-1 border">Total pagado</th>
          <th class="px-2 py-1 border">Saldo calculado</th>
          <th class="px-2 py-1 border">Motivo</th>
          <th class="px-2 py-1 border">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of rows()">
          <td class="px-2 py-1 border font-mono">{{ r.uuidFactura }}</td>
          <td class="px-2 py-1 border">
            {{ r.fechaFactura | date: "yyyy-MM-dd" }}
          </td>
          <td class="px-2 py-1 border">{{ r.rfcEmisorFactura }}</td>
          <td class="px-2 py-1 border">{{ r.rfcReceptorFactura }}</td>
          <td class="px-2 py-1 border">{{ r.rfcContraparte }}</td>
          <td class="px-2 py-1 border">{{ r.metodoPago }}</td>
          <td class="px-2 py-1 border">{{ r.formaPago }}</td>
          <td class="px-2 py-1 border text-right">
            {{ r.totalFactura }}
          </td>
          <td class="px-2 py-1 border text-right">
            {{ r.numeroPagos }}
          </td>
          <td class="px-2 py-1 border text-right">
            {{ r.totalPagado }}
          </td>
          <td class="px-2 py-1 border text-right">
            {{ r.saldoCalculado }}
          </td>
          <td class="px-2 py-1 border text-[0.7rem]">
            {{ r.motivo }}
          </td>
          <td class="px-2 py-1 border text-center">
            <button
              class="px-2 py-0.5 text-[0.7rem] bg-teal-600 text-white rounded"
              (click)="irAPago(r)"
            >
              Ver pago
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Sin datos -->
  <p *ngIf="!rows().length && !loading()" class="text-xs text-gray-500">
    No hay facturas PUE con pagos relacionados para los filtros seleccionados.
  </p>
</section>
